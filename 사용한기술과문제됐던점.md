# 기술과 문제점

## 기술

- Alamofire와 FacebookLogin

```
    func textFieldShouldReturn(_ textField: UITextField) -> Bool {
        guard let token = strToken, let searchWord = searchTextField.text else { return false }
        
        // 토큰헤더 형식으로
        let headerToken = "token " + token
        let userToken: HTTPHeaders = [
            "Authorization": headerToken
        ]
        
        // searchWord는 한글로도 입력가능하기때문에 변환
        // addingPercentEncoding: 지정한 문자 집합에 없는 문자열의 모든 문자를 퍼센트 인코딩된 문자로 바꾸어 만든 새 문자열을 반환합니다.
        // urlQueryAllowed: 쿼리 URL구성 요소에 허용되는 문자 집합을 반환합니다.
        let search = searchWord.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed)!
        let url = "https://justdo2t.com/api/movie/search/?movie=\(search)"
        
        // 기본 SessionManager를 사용하여 지정된 URL, 메서드, 매개 변수, 인코딩 및 헤더의 내용을 검색하는 DataRequest를 만듭니다.
        // validate: 응답에 지정된 시퀀스의 상태 코드가 있는지 확인합니다. 유효성 검사가 실패하면 이후의 응답 핸들러 호출은 연관된 오류를 갖습니다.
        // 요청이 완료되면 호출 할 처리기를 추가합니다.
        Alamofire.request(url, method: .get, encoding: URLEncoding.default, headers: userToken)
            .validate(statusCode: 200..<300)
            .responseJSON { response in
                if let error = response.error {
                // 에러 처리
                // 만약 결과가 실패, nil, 다른 문제가 있다면 연관된 결과값을 리턴합니다.
                    dump(error)
                    return
                }
                
                do {
                    let data = try JSONSerialization.data(withJSONObject: response.result.value!, options: .prettyPrinted)
                    let decoder: JSONDecoder = JSONDecoder()
                    self.searchResult = try decoder.decode(SearchMovie.self, from: data)
                    self.SearchMovies = self.searchResult.results
                    self.searchBool = true
                    self.HometableView.reloadData()
                } catch {
                // 에러 처리
                // 위의 에러처리와의 차이점은 위는 통신상의 오류라면, do-catch에서는 형식상, 또는 잘못된 값 등의 오류를 잡는다.
                }
        }
        
        return true
    }
```

- 정규식

## 문제점

- 로그인하고 메인 화면에서 왼쪽 끝에서 오른쪽으로 제스쳐를 넣으면 다시 로그인으로 돌아갔다.

> 이는 show segue로 화면 전환을 주어서 문제가 되었던 것 같다. show segue는 stack구조로서 원래 화면 위에 새 화면을 덮는 형식이다. 이를 해결하기 위해서는 로그인 성공 후에 첫화면을 루트뷰로 설정하면 될 것 같다.

